import{u as gt,_ as kt,a as $t}from"./list-356efb39.js";import{o as u,c as _,b as t,V as Y,ao as Ct,u as tt,J as g,t as D,r as v,ap as Tt,d as wt,p as qt,s as Vt,a as It,A as At,D as A,n as St,B as Mt,C as Dt,ah as Lt,E as Bt,aq as Qt,H as Rt,I as Ft,e as i,g as n,F as w,w as d,k as S,f as a,v as Nt,K as M,L as Pt,M as Ut,N as O,O as Zt,y as X,x as zt,j as Et,ar as Gt,R as j,X as Kt,l as xt,z as J,S as W,aa as Ht,Y as Ot,as as Xt,a2 as jt,a3 as Jt,_ as Wt}from"./index-71bc54e4.js";import{_ as Yt}from"./FieldId-5e4e1706.js";import{_ as te}from"./Multiselect-390a6b3e.js";import{_ as ee,a as oe}from"./label-outline-rounded-2663147f.js";import{a as se,b as ne,_ as ae}from"./files-b279a28c.js";import{_ as le}from"./delete-outline-rounded-d0e9e9e7.js";import{_ as ie}from"./Breadcrumb-9e507271.js";import{b as de,a as ue}from"./search-cd166c4f.js";import{n as ce}from"./list-6498ebd9.js";import{u as re,a as pe,b as _e}from"./tags-bbc0b0f2.js";import{u as me,_ as he}from"./ConfirmModal.vuevuetypescriptsetuptruelang-d42f5501.js";import{_ as be}from"./DeleteConfirm.vuevuetypescriptsetuptruelang-131cf6c7.js";import"./VModal.vuevuetypescriptsetuptruelang-1499a382.js";import"./baseIndexOf-70b929c6.js";import"./toInteger-357e9f33.js";import"./vee-validate.esm-b28bbd9f.js";const fe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ye=t("path",{fill:"currentColor",d:"M9.5 9.325v5.35q0 .6.525.875t1.025-.05l4.15-2.65q.475-.275.475-.85t-.475-.85L11.05 8.5q-.5-.325-1.025-.05t-.525.875ZM12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Zm0-10Zm0 8q3.325 0 5.663-2.337T20 12q0-3.325-2.337-5.663T12 4Q8.675 4 6.337 6.337T4 12q0 3.325 2.337 5.663T12 20Z"},null,-1),ve=[ye];function ge(c,m){return u(),_("svg",fe,ve)}const ke={name:"material-symbols-play-circle-outline-rounded",render:ge},$e={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ce=t("path",{fill:"currentColor",d:"M3 16v-2h7v2H3Zm0-4v-2h11v2H3Zm0-4V6h11v2H3Zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4h-2Z"},null,-1),Te=[Ce];function we(c,m){return u(),_("svg",$e,Te)}const qe={name:"material-symbols-playlist-add",render:we},Ve=c=>{const{mutate:m,loading:l,onDone:f}=Y({document:Ct,appApi:!0}),{t:p}=tt();return f(()=>{g.emit("refetch_app"),D(p("added_to_playlist"))}),{loading:l,addItemsToPlaylist:()=>{const r=c.value.filter(k=>k.checked);if(r.length===0){D(p("select_first"),"error");return}m({paths:r.map(k=>k.path)})},addToPlaylist:r=>{m({paths:[r.path]})}}},Ie=()=>{const c=v(""),{mutate:m,loading:l,onDone:f}=Y({document:Tt,appApi:!0});return f(()=>{g.emit("refetch_app"),g.emit("play_audio")}),{loading:l,playing:c,play:p=>{c.value=p.path,m({path:p.path})}}},Ae=c=>(jt("data-v-f69d94e8"),c=c(),Jt(),c),Se={class:"v-toolbar"},Me={class:"right-actions"},De=["title"],Le=["title"],Be=["title"],Qe=["title"],Re=["title"],Fe=["onClick"],Ne={class:"row mb-3"},Pe={class:"col-md-3 col-form-label"},Ue={class:"col-md-9"},Ze=["onKeyup"],ze={class:"row mb-3"},Ee={class:"col-md-3 col-form-label"},Ge={class:"col-md-9"},Ke={class:"actions"},xe=["onClick"],He={class:"table"},Oe=Ae(()=>t("th",null,"ID",-1)),Xe=["onClick"],je=["onUpdate:modelValue"],Je={class:"audio-btns"},We={key:0,class:"spinner spinner-sm"},Ye={class:"badge"},to={key:0},eo={colspan:"7"},oo={class:"no-data-placeholder"},so=wt({__name:"AudiosView",setup(c){var E,G;const m=qt(),l=v([]),{t:f}=tt(),{app:p}=Vt(It()),r=At({text:"",tags:[]}),k=A(()=>p.value.audios??[]);A(()=>{const o=p.value.audioCurrent;return k.value.find(s=>s.path==o)});const et=A(()=>l.value.some(o=>o.checked)),b="AUDIO",L=St().query,$=v(parseInt(((E=L.page)==null?void 0:E.toString())??"1")),C=50,T=v(0),y=v(Mt(((G=L.q)==null?void 0:G.toString())??"")),B=v(""),{tags:q}=re(b,y,r,async o=>{B.value=de(o),await Dt(),ut()}),{addItemsToPlaylist:Q,addToPlaylist:ot}=Ve(l),{addToTags:R}=pe(b,l,q),{removeFromTags:F}=_e(b,l,q),{deleteItems:N}=me(b,l),{downloadItems:P}=se(l,"audios.zip"),{downloadFile:st}=ne(p),nt=Lt(),{play:at,playing:lt,loading:it}=Ie(),{selectAll:V,toggleSelect:U}=gt(l),{loading:dt,load:ut,refetch:ct}=Bt({handle:(o,s)=>{s?D(f(s),"error"):o&&(l.value=o.audios.map(I=>({...I,checked:!1})),T.value=o.audioCount)},document:Qt,variables:()=>({offset:($.value-1)*C,limit:C,query:B.value}),appApi:!0});Rt($,o=>{J(m,`/audios?page=${o}&q=${W(y.value)}`)});function rt(){nt.push("/files"),Ht(he,{message:f("upload_audios")})}function Z(){y.value=ue(r),z()}function z(){J(m,`/audios?q=${W(y.value)}`)}Ft(()=>{g.on("refetch_by_tag_type",o=>{o===b&&ct()})});function pt(o){Ot(be,{id:o.id,name:o.title,gql:Xt,variables:()=>({tagType:b,id:o.id}),appApi:!0,typeName:"Audio",done:()=>{g.emit("refetch_app"),g.emit("refetch_by_tag_type",b)}})}return(o,s)=>{const I=ie,K=le,x=ae,H=qe,_t=ee,mt=oe,ht=te,bt=kt,ft=Yt,yt=ke,vt=$t;return u(),_(w,null,[t("div",Se,[i(I,{current:()=>`${o.$t("page_title.audios")} (${T.value})`},null,8,["current"]),t("div",Me,[n(et)?(u(),_(w,{key:0},[t("button",{type:"button",class:"btn btn-action",onClick:s[0]||(s[0]=d((...e)=>n(N)&&n(N)(...e),["stop"])),title:o.$t("delete")},[i(K,{class:"bi"})],8,De),t("button",{type:"button",class:"btn btn-action",onClick:s[1]||(s[1]=d((...e)=>n(P)&&n(P)(...e),["stop"])),title:o.$t("download")},[i(x,{class:"bi"})],8,Le),t("button",{type:"button",class:"btn btn-action",onClick:s[2]||(s[2]=d((...e)=>n(Q)&&n(Q)(...e),["stop"])),title:o.$t("add_to_playlist")},[i(H,{class:"bi"})],8,Be),t("button",{type:"button",class:"btn btn-action",onClick:s[3]||(s[3]=d((...e)=>n(R)&&n(R)(...e),["stop"])),title:o.$t("add_to_tags")},[i(_t,{class:"bi"})],8,Qe),t("button",{type:"button",class:"btn btn-action",onClick:s[4]||(s[4]=d((...e)=>n(F)&&n(F)(...e),["stop"])),title:o.$t("remove_from_tags")},[i(mt,{class:"bi"})],8,Re)],64)):S("",!0),t("button",{type:"button",class:"btn btn-action",onClick:d(rt,["stop"])},a(o.$t("upload")),9,Fe),i(bt,{modelValue:y.value,"onUpdate:modelValue":s[7]||(s[7]=e=>y.value=e),search:z},{filters:Nt(()=>[t("div",Ne,[t("label",Pe,a(o.$t("keywords")),1),t("div",Ue,[M(t("input",{type:"text","onUpdate:modelValue":s[5]||(s[5]=e=>r.text=e),class:"form-control",onKeyup:Ut(Z,["enter"])},null,40,Ze),[[Pt,r.text]])])]),t("div",ze,[t("label",Ee,a(o.$t("tags")),1),t("div",Ge,[i(ht,{modelValue:r.tags,"onUpdate:modelValue":s[6]||(s[6]=e=>r.tags=e),label:"name","track-by":"id",options:n(q)},null,8,["modelValue","options"])])]),t("div",Ke,[t("button",{type:"button",class:"btn",onClick:d(Z,["stop"])},a(o.$t("search")),9,xe)])]),_:1},8,["modelValue"])])]),t("table",He,[t("thead",null,[t("tr",null,[t("th",null,[M(t("input",{class:"form-check-input",type:"checkbox",onChange:s[8]||(s[8]=(...e)=>n(U)&&n(U)(...e)),"onUpdate:modelValue":s[9]||(s[9]=e=>Zt(V)?V.value=e:null)},null,544),[[O,n(V)]])]),Oe,t("th",null,a(o.$t("name")),1),t("th",null,a(o.$t("artist")),1),t("th",null,a(o.$t("tags")),1),t("th",null,a(o.$t("duration")),1),t("th",null,a(o.$t("file_size")),1)])]),t("tbody",null,[(u(!0),_(w,null,X(l.value,e=>(u(),_("tr",{key:e.id,class:zt({checked:e.checked}),onClick:d(h=>e.checked=!e.checked,["stop"])},[t("td",null,[M(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":h=>e.checked=h},null,8,je),[[O,e.checked]])]),t("td",null,[i(ft,{id:e.id,raw:e},null,8,["id","raw"])]),t("td",null,[Et(a(e.title)+" ",1),t("span",Je,[i(K,{class:"bi bi-btn",onClick:d(h=>pt(e),["stop"])},null,8,["onClick"]),i(x,{class:"bi bi-btn",onClick:d(h=>n(st)(e.path,n(Gt)(e.path).replace(" ","-")),["stop"])},null,8,["onClick"]),i(H,{class:"bi bi-btn",onClick:d(h=>n(ot)(e),["stop"])},null,8,["onClick"]),n(it)&&e.path===n(lt)?(u(),_("i",We)):(u(),j(yt,{key:1,class:"bi bi-btn",onClick:d(h=>n(at)(e),["stop"])},null,8,["onClick"]))])]),t("td",null,a(e.artist),1),t("td",null,[(u(!0),_(w,null,X(e.tags,h=>(u(),_("span",Ye,a(h.name),1))),256))]),t("td",null,a(n(Kt)(e.duration)),1),t("td",null,a(n(xt)(e.size)),1)],10,Xe))),128))]),l.value.length?S("",!0):(u(),_("tfoot",to,[t("tr",null,[t("td",eo,[t("div",oo,a(o.$t(n(ce)(n(dt),n(p).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))]),T.value>C?(u(),j(vt,{key:0,modelValue:$.value,"onUpdate:modelValue":s[10]||(s[10]=e=>$.value=e),total:T.value,limit:C},null,8,["modelValue","total"])):S("",!0)],64)}}});const Co=Wt(so,[["__scopeId","data-v-f69d94e8"]]);export{Co as default};
