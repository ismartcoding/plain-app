import{u as ie,_ as ue,a as ce}from"./list-a58e063e.js";import{_ as de}from"./FieldId-4a415062.js";import{u as pe,a as re,b as _e,_ as fe}from"./files-ae28db41.js";import{_ as he}from"./Breadcrumb-2d9a8da6.js";import{d as me,p as ve,r as f,u as ke,s as ye,a as ge,A as be,D as $e,n as we,B as Ce,i as Se,t as Ve,$ as Ie,H as Ae,V as De,a0 as Ue,E as qe,a1 as Qe,I as Be,J as Le,o as u,c as d,b as t,e as h,g as n,w as _,k as A,f as o,v as Me,K as D,L as ze,M as Fe,N as K,O as Te,F as N,y as Pe,x as xe,j as Ke,l as Ne,P as R,Q as G,R as Re,z as C,S,a2 as Ge,a3 as Ee,_ as je}from"./index-e9c32210.js";import{n as He}from"./list-6498ebd9.js";import{c as Je,b as E}from"./search-72516736.js";import"./VModal.vuevuetypescriptsetuptruelang-22961625.js";import"./baseIndexOf-70b929c6.js";import"./toInteger-6e276fa2.js";function Oe(c,V){const m=c.findIndex(v=>v.id===V);m!==-1&&c.splice(m,1)}const We=c=>(Ge("data-v-5ba739a6"),c=c(),Ee(),c),Xe={class:"v-toolbar"},Ye={class:"right-actions"},Ze=["title"],et=["onClick"],tt={class:"row mb-3"},st={class:"col-md-3 col-form-label"},at={class:"col-md-9"},ot=["onKeyup"],nt={class:"actions"},lt=["onClick"],it={class:"table"},ut={class:"actions"},ct=["onClick"],dt=["onUpdate:modelValue"],pt=We(()=>t("br",null,null,-1)),rt={class:"nowrap"},_t=["title"],ft=["title"],ht={class:"actions one"},mt={key:0},vt=["onClick"],kt={key:0},yt={colspan:"8"},gt={class:"no-data-placeholder"},bt=me({__name:"AppsView",setup(c){var T,P;const{input:V,upload:m,uploadChanged:v}=pe(),k=ve(),l=f([]),{t:j}=ke(),{app:U}=ye(ge()),y=be({text:"",tags:[]}),H=$e(()=>l.value.some(e=>e.checked)),{downloadItems:q}=re(l,"apps.zip"),{downloadFile:J}=_e(U),Q=we(),B=Q.query,g=f(parseInt(((T=B.page)==null?void 0:T.toString())??"1")),b=50,$=f(0),i=f(Ce(((P=B.q)==null?void 0:P.toString())??"")),L=Je(i.value),p=Q.params.type;p&&L.push({name:"type",op:"",value:p});const O=f(E(L)),W=()=>{m(U.value.downloadsDir)},{selectAll:I,toggleSelect:M}=ie(l),{loading:X}=Se({handle:(e,a)=>{a?Ve(j(a),"error"):e&&(l.value=e.packages.map(r=>({...r,checked:!1})),$.value=e.packageCount)},document:Ie,variables:()=>({offset:(g.value-1)*b,limit:b,query:O.value}),appApi:!0});Ae(g,e=>{p?C(k,`/apps/${p}?page=${e}&q=${S(i.value)}`):C(k,`/apps?page=${e}&q=${S(i.value)}`)});function z(){const e=[];y.text&&e.push({name:"text",op:"",value:y.text}),i.value=E(e),F()}function F(){p?C(k,`/apps/${p}?q=${S(i.value)}`):C(k,`/apps?q=${S(i.value)}`)}const{mutate:Y,onDone:Z}=De({document:Ue,appApi:!0});function ee(e){Z(()=>{e.isUninstalling=!0}),Y({id:e.id})}const{loading:te,load:se,refetch:ae}=qe({handle:(e,a)=>{if(e)for(const r of e.packageStatuses)r.exist||Oe(l.value,r.id)},document:Qe,variables:()=>({ids:l.value.filter(e=>e.isUninstalling).map(e=>e.id)}),appApi:!0});return Be(()=>{Le.on("upload_task_done",a=>{a.status});let e=!0;setInterval(()=>{l.value.some(a=>a.isUninstalling)&&!te.value&&(e?(se(),e=!1):ae())},1e3)}),(e,a)=>{const r=he,x=fe,oe=ue,ne=de,le=ce;return u(),d(N,null,[t("div",Xe,[h(r,{current:()=>`${e.$t("page_title.apps")} (${$.value})`},null,8,["current"]),t("div",Ye,[n(H)?(u(),d("button",{key:0,type:"button",class:"btn btn-action",onClick:a[0]||(a[0]=_((...s)=>n(q)&&n(q)(...s),["stop"])),title:e.$t("download")},[h(x,{class:"bi"})],8,Ze)):A("",!0),t("button",{type:"button",class:"btn btn-action",onClick:_(W,["stop"]),style:{display:"none"}},o(e.$t("install")),9,et),h(oe,{modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=s=>i.value=s),search:F},{filters:Me(()=>[t("div",tt,[t("label",st,o(e.$t("keywords")),1),t("div",at,[D(t("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=s=>y.text=s),class:"form-control",onKeyup:Fe(z,["enter"])},null,40,ot),[[ze,y.text]])])]),t("div",nt,[t("button",{type:"button",class:"btn",onClick:_(z,["stop"])},o(e.$t("search")),9,lt)])]),_:1},8,["modelValue"])])]),t("table",it,[t("thead",null,[t("tr",null,[t("th",null,[D(t("input",{class:"form-check-input",type:"checkbox",onChange:a[3]||(a[3]=(...s)=>n(M)&&n(M)(...s)),"onUpdate:modelValue":a[4]||(a[4]=s=>Te(I)?I.value=s:null)},null,544),[[K,n(I)]])]),t("th",null,o(e.$t("name")),1),t("th",null,o(e.$t("version")),1),t("th",null,o(e.$t("size")),1),t("th",null,o(e.$t("type")),1),t("th",null,o(e.$t("installed_at")),1),t("th",null,o(e.$t("updated_at")),1),t("th",ut,o(e.$t("actions")),1)])]),t("tbody",null,[(u(!0),d(N,null,Pe(l.value,s=>(u(),d("tr",{key:s.id,class:xe({checked:s.checked}),onClick:_(w=>s.checked=!s.checked,["stop"])},[t("td",null,[D(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":w=>s.checked=w},null,8,dt),[[K,s.checked]])]),t("td",null,[t("strong",null,[Ke(o(s.name)+" ",1),h(x,{class:"bi bi-btn",onClick:_(w=>n(J)(s.path,`${s.name.replace(" ","")}-${s.id}.apk`),["stop"])},null,8,["onClick"])]),pt,h(ne,{id:s.id,raw:s},null,8,["id","raw"])]),t("td",null,o(s.version),1),t("td",null,o(n(Ne)(s.size)),1),t("td",rt,o(e.$t("app_type."+s.type)),1),t("td",{class:"nowrap",title:n(R)(s.installedAt)},o(n(G)(s.installedAt)),9,_t),t("td",{class:"nowrap",title:n(R)(s.updatedAt)},o(n(G)(s.updatedAt)),9,ft),t("td",ht,[s.isUninstalling?(u(),d("span",mt,o(e.$t("uninstalling")),1)):(u(),d("a",{key:1,href:"#",class:"v-link",onClick:_(w=>ee(s),["stop"])},o(e.$t("uninstall")),9,vt))])],10,ct))),128))]),l.value.length?A("",!0):(u(),d("tfoot",kt,[t("tr",null,[t("td",yt,[t("div",gt,o(e.$t(n(He)(n(X)))),1)])])]))]),$.value>b?(u(),Re(le,{key:0,modelValue:g.value,"onUpdate:modelValue":a[5]||(a[5]=s=>g.value=s),total:$.value,limit:b},null,8,["modelValue","total"])):A("",!0),t("input",{ref_key:"fileInput",ref:V,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:a[6]||(a[6]=(...s)=>n(v)&&n(v)(...s))},null,544)],64)}}});const Qt=je(bt,[["__scopeId","data-v-5ba739a6"]]);export{Qt as default};
