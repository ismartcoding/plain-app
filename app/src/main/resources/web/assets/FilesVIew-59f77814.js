import{o as c,c as u,b as l,d as ke,V as be,Z as Ye,a5 as et,R as q,v as B,g as s,f as p,u as tt,r as D,n as st,B as ot,p as at,s as ce,a as nt,ai as lt,aO as it,D as ct,H as rt,I as ut,J as dt,e as w,F as b,w as re,k as _,K as N,N as z,O as pt,y as ue,x as mt,aP as de,aQ as pe,af as _t,j as S,Q as ht,l as V,aR as ft,Y as M,am as vt,aS as kt,_ as bt}from"./index-71bc54e4.js";import{c as yt,d as gt,e as Ct,f as Dt,g as wt,h as Vt,u as me,b as $t,_ as xt,i as Ft,j as It}from"./files-b279a28c.js";import{_ as Tt}from"./delete-outline-rounded-d0e9e9e7.js";import{_ as St}from"./Breadcrumb-9e507271.js";import{c as _e}from"./index-92f07970.js";import{g as he,M as Mt}from"./splitpanes.es-9bf0a422.js";import{n as qt}from"./list-6498ebd9.js";import{_ as Bt}from"./VModal.vuevuetypescriptsetuptruelang-1499a382.js";import{t as Pt}from"./truncate-9cd95ca4.js";import{_ as fe}from"./EditValueModal.vuevuetypescriptsetuptruelang-f6bb53bb.js";import{c as Rt}from"./search-cd166c4f.js";import"./baseIndexOf-70b929c6.js";import"./toInteger-357e9f33.js";import"./stringToArray-46240aba.js";import"./vee-validate.esm-b28bbd9f.js";const Ut={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},At=l("path",{fill:"currentColor",d:"M4 20q-.825 0-1.413-.588T2 18V6q0-.825.588-1.413T4 4h5.175q.4 0 .763.15t.637.425L12 6h8q.825 0 1.413.588T22 8v10q0 .825-.588 1.413T20 20H4ZM4 6v12h16V8h-8.825l-2-2H4Zm0 0v12V6Z"},null,-1),Et=[At];function Ht($,o){return c(),u("svg",Ut,Et)}const Nt={name:"material-symbols-folder-outline-rounded",render:Ht},zt=["disabled"],ve=ke({__name:"DeleteFileConfirm",props:{onDone:{type:Function,required:!0},files:{type:Array,required:!0}},setup($){const o=$,{mutate:x,loading:F,onDone:P}=be({document:Ye`
    mutation DeleteFiles($paths: [String!]!) {
      deleteFiles(paths: $paths)
    }
  `,appApi:!0});function h(){x({paths:o.files.map(f=>f.path)})}return P(()=>{o.onDone(o.files),et()}),(f,I)=>{const m=Bt;return c(),q(m,{class:"delete-modal",title:f.$t("confirm_to_delete_name",{name:s(Pt)($.files.map(k=>k.name).join(", "),{length:200})})},{action:B(()=>[l("button",{type:"button",disabled:s(F),class:"btn",onClick:h},p(f.$t("delete")),9,zt)]),_:1},8,["title"])}}}),Ot={class:"v-toolbar"},Lt={class:"right-actions"},Qt=["onClick","title"],Wt=["onClick","title"],Zt={class:"form-check mt-2 me-3 ms-3"},jt={class:"form-check-label",for:"select-mode"},Gt={class:"form-check mt-2"},Jt={class:"form-check-label",for:"show-hidden"},Kt={class:"file-items"},Xt=["onClick","onDblclick","onContextmenu"],Yt=["onUpdate:modelValue"],es=["src"],ts={class:"title"},ss={style:{"font-size":"0.75rem"}},os=["onContextmenu"],as={key:0,class:"no-files"},ns={key:0,class:"file-item-info"},ls=ke({__name:"FilesVIew",setup($){var oe,ae,ne,le;const{t:o}=tt(),x=D([]),F=st(),P=F.query,h=F.params.type,f=D(ot(((oe=P.q)==null?void 0:oe.toString())??"")),I=Rt(f.value),m=D(((ae=I.find(e=>e.name==="path"))==null?void 0:ae.value)??"");let k=((ne=I.find(e=>e.name==="dir"))==null?void 0:ne.value)??"";k||(((le=I.find(t=>t.name==="isDir"))==null?void 0:le.value)==="1"?k=m.value:k=m.value.substring(0,m.value.lastIndexOf("/")));const ye=D(k),y=D(!1),O=at(),{app:v}=ce(nt());let R=v.value.internalStoragePath;h==="sdcard"?R=v.value.sdcardPath:h==="app"&&(R=v.value.externalFilesDir);const{loading:ge,panels:d,currentDir:U,refetch:L}=yt(v,R,ye.value),{visible:Ce,index:De,view:we,hide:Ve}=lt(),{createPath:$e,createVariables:xe,createMutation:Fe}=gt(v,d),{renameValue:Ie,renamePath:Te,renameDone:Se,renameMutation:Me,renameVariables:qe}=Ct(d),{internal:Q,sdcard:W,refetch:A}=Dt(),{onDeleted:Z}=Ft(d,U,A),{downloadFile:j,downloadDir:Be,downloadFiles:Pe}=$t(v),{view:G}=It(x,we),{selectedItem:T,select:Re}=wt(U,h,f,O),{canPaste:J,copy:K,cut:Ue,paste:E}=Vt(L,A),{input:Ae,upload:X,uploadChanged:Y}=me(),{input:Ee,upload:ee,uploadChanged:te}=me(),{mutate:He,onDone:Ne}=be({document:it,appApi:!0});Ne(e=>{Pe(e.data.setTempValue.key)});const H=()=>{const e=[];return d.value.forEach(t=>{t.items.forEach(a=>{a.checked&&e.push(a)})}),e},ze=()=>{He({key:ft(),value:JSON.stringify(H().map(e=>({path:e.path})))})},Oe=ct(()=>H().length>0),Le=()=>{M(ve,{files:H(),onDone:Z})},{fileShowHidden:g}=ce(O);m.value&&rt(()=>d.value.length,()=>{if(d.value.length>0&&m.value){const t=d.value[d.value.length-1].items.find(a=>a.path===m.value);t&&(T.value=t,m.value="")}});function Qe(){var e,t,a,i;return h==="sdcard"?`${o("sdcard")} (${o("storage_free_total",{free:V((e=W.value)==null?void 0:e.freeBytes),total:V((t=W.value)==null?void 0:t.totalBytes)})})`:h==="app"?o("app_name"):`${o("page_title.files")} (${o("storage_free_total",{free:V((a=Q.value)==null?void 0:a.freeBytes),total:V((i=Q.value)==null?void 0:i.totalBytes)})})`}function We(e,t){if(y.value){t.checked=!t.checked;return}Re(e,t)}function se(e){return de(e.name)||pe(e.name)||kt(e.name)}function Ze(e,t){t.isDir||(se(t)?G(e.items,t):j(t.path))}function je(e,t){e.preventDefault();const a=[{label:o("create_folder"),onClick:()=>{$e.value=t,M(fe,{title:o("name"),placeholder:o("name"),mutation:Fe,getVariables:xe})}},{label:o("upload_files"),onClick:()=>{X(t)}},{label:o("upload_folder"),onClick:()=>{ee(t)}}];J()&&a.push({label:o("paste"),onClick:()=>{E(t)}}),_e({x:e.x,y:e.y,items:a})}function Ge(e,t,a){e.preventDefault();let i;a.isDir?i=[{label:o("upload_files"),onClick:()=>{X(a.path)}},{label:o("upload_folder"),onClick:()=>{ee(a.path)}},{label:o("download"),onClick:()=>{Be(a.path)}}]:(i=[],se(a)&&i.push({label:o("open"),onClick:()=>{G(t.items,a)}}),i.push({label:o("download"),onClick:()=>{j(a.path)}})),i.push({label:o("duplicate"),onClick:()=>{K(a),E(t.dir)}}),i.push({label:o("cut"),onClick:()=>{Ue(t,a)}}),i.push({label:o("copy"),onClick:()=>{K(a)}}),a.isDir&&J()&&i.push({label:o("paste"),onClick:()=>{E(a.path)}}),i=[...i,{label:o("rename"),onClick:()=>{Ie.value=a.name,Te.value=a.path,M(fe,{title:o("rename"),placeholder:o("name"),value:a.name,mutation:Me,getVariables:qe,done:Se})}},{label:o("delete"),onClick:()=>{M(ve,{files:[a],onDone:Z})}}],_e({x:e.x,y:e.y,items:i})}return ut(()=>{dt.on("upload_task_done",e=>{e.status==="done"&&setTimeout(()=>{L(e.dir),A()},1e3)})}),(e,t)=>{const a=St,i=Tt,Je=xt,Ke=Nt,Xe=vt;return c(),u(b,null,[l("div",Ot,[w(a,{current:Qe}),l("div",Lt,[y.value&&s(Oe)?(c(),u(b,{key:0},[l("button",{type:"button",class:"btn btn-action",onClick:re(Le,["stop"]),title:e.$t("delete")},[w(i,{class:"bi"})],8,Qt),l("button",{type:"button",class:"btn btn-action",onClick:re(ze,["stop"]),title:e.$t("download")},[w(Je,{class:"bi"})],8,Wt)],64)):_("",!0),l("div",Zt,[N(l("input",{class:"form-check-input","onUpdate:modelValue":t[0]||(t[0]=r=>y.value=r),id:"select-mode",type:"checkbox"},null,512),[[z,y.value]]),l("label",jt,p(e.$t("select_mode")),1)]),l("div",Gt,[N(l("input",{class:"form-check-input","onUpdate:modelValue":t[1]||(t[1]=r=>pt(g)?g.value=r:null),id:"show-hidden",type:"checkbox"},null,512),[[z,s(g)]]),l("label",Jt,p(e.$t("show_hidden")),1)])])]),w(s(Mt),{class:"panel-container"},{default:B(()=>[(c(!0),u(b,null,ue(s(d),r=>(c(),q(s(he),{key:r.dir},{default:B(()=>[l("div",Kt,[(c(!0),u(b,null,ue(r.items,n=>{var ie;return c(),u(b,{key:n.path},[!n.name.startsWith(".")||s(g)?(c(),u("div",{key:0,class:mt(["file-item",{active:(s(U)+"/").startsWith(n.path+"/")||((ie=s(T))==null?void 0:ie.path)===n.path}]),onClick:C=>We(r,n),onDblclick:C=>Ze(r,n),onContextmenu:C=>Ge(C,r,n)},[y.value?N((c(),u("input",{key:0,class:"form-check-input","onUpdate:modelValue":C=>n.checked=C,type:"checkbox"},null,8,Yt)),[[z,n.checked]]):_("",!0),n.isDir?(c(),q(Ke,{key:1,class:"bi"})):_("",!0),s(de)(n.name)||s(pe)(n.name)?(c(),u("img",{key:2,src:s(_t)(n.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,es)):_("",!0),l("div",ts,[S(p(n.name)+" ",1),l("div",ss,[S(p(s(ht)(n.updatedAt)),1),n.isDir?_("",!0):(c(),u(b,{key:0},[S(", "+p(s(V)(n.size)),1)],64))])])],42,Xt)):_("",!0)],64)}),128)),l("div",{class:"empty",onContextmenu:n=>je(n,r.dir)},[r.items.filter(n=>!n.name.startsWith(".")||s(g)).length===0?(c(),u("div",as,p(e.$t("no_files")),1)):_("",!0)],40,os)])]),_:2},1024))),128)),s(d).length===0?(c(),q(s(he),{key:0,class:"no-data-placeholder"},{default:B(()=>[S(p(e.$t(s(qt)(s(ge),s(v).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):_("",!0)]),_:1}),s(T)?(c(),u("div",ns,p(e.$t("path"))+": "+p(s(T).path),1)):_("",!0),w(Xe,{visible:s(Ce),index:s(De),sources:x.value,onHide:s(Ve)},null,8,["visible","index","sources","onHide"]),l("input",{ref_key:"fileInput",ref:Ae,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...r)=>s(Y)&&s(Y)(...r))},null,544),l("input",{ref_key:"dirFileInput",ref:Ee,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[3]||(t[3]=(...r)=>s(te)&&s(te)(...r))},null,544)],64)}}});const Cs=bt(ls,[["__scopeId","data-v-3136639c"]]);export{Cs as default};
