import{_ as ce}from"./FieldId-a6855e87.js";import{_ as re}from"./Breadcrumb-f25190bb.js";import{d as ae,A as ue,r as A,u as le,U as Q,a3 as R,bR as C,bS as pe,a0 as me,G as _e,a1 as W,o as c,Q as fe,v as F,b as e,f as n,J as f,bT as T,c as r,F as y,y as w,g as d,a5 as O,N as Z,K as x,e as N,k as J,a7 as ve,i as ge,t as he,Y as L,bU as be,bV as $e,M as ke,O as ee,P as te,w as oe,X as B}from"./index-b61558b0.js";import{T as b,a as $,_ as ye,A as we}from"./question-mark-rounded-46daae2d.js";import{_ as Ce}from"./DeleteConfirm.vuevuetypescriptsetuptruelang-10c33046.js";import{_ as Ve}from"./VModal.vuevuetypescriptsetuptruelang-97be675f.js";import{u as Fe,a as Te}from"./vee-validate.esm-3e89ad50.js";import"./stringToArray-38452596.js";import"./baseIndexOf-70b929c6.js";const Ae={class:"row"},Ne={class:"col-md-3 col-form-label"},De={class:"col-md-9 form-checks"},Ie={class:"form-check form-check-inline"},Ue={class:"form-check-label",for:"action-allow"},Me={class:"form-check form-check-inline"},Se={class:"form-check-label",for:"action-block"},Ee={class:"row mb-2"},qe={for:"action",class:"col-md-3 col-form-label"},Re={class:"col-md-9 form-checks"},Oe={class:"form-check form-check-inline"},Je={class:"form-check-label",for:"direction-inbound"},Le={class:"form-check form-check-inline"},Be={class:"form-check-label",for:"direction-outbound"},Qe={class:"row mb-3"},je={class:"col-md-3 col-form-label"},Ge={class:"col-md-9"},Ke=["value"],Pe={key:0,class:"input-group mt-2"},Xe=["placeholder"],Ye={class:"inner"},ze={class:"help-block"},He={value:""},We=["value"],Ze={key:2,class:"invalid-feedback"},xe={class:"row mb-3"},et={class:"col-md-3 col-form-label"},tt={class:"col-md-9"},ot={value:"all"},nt=["value"],at=["value"],lt={class:"row mb-3"},st={class:"col-md-3 col-form-label"},it={class:"col-md-9"},dt=["disabled"],ne=ae({__name:"EditRuleModal",props:{data:{type:Object},devices:{type:Array},networks:{type:Array}},setup(k){var j,G,K,P,X,Y,z;const v=k,{handleSubmit:h}=Fe(),s=ue({action:"block",direction:"inbound",protocol:"all",apply_to:"all",notes:"",target:"",is_enabled:!0}),u=A(b.DNS),D=Object.values(b),{t:I}=le(),{mutate:U,loading:M,onDone:S}=Q({document:R`
    mutation createConfig($input: ConfigInput!) {
      createConfig(input: $input) {
        ...ConfigFragment
      }
    }
    ${C}
  `,options:{update:(a,i)=>{pe(a,i.data.createConfig,R`
          query {
            configs {
              ...ConfigFragment
            }
          }
          ${C}
        `)}}}),{mutate:E,loading:q,onDone:l}=Q({document:R`
    mutation updateConfig($id: ID!, $input: ConfigInput!) {
      updateConfig(id: $id, input: $input) {
        ...ConfigFragment
      }
    }
    ${C}
  `}),{value:p,resetField:m,errorMessage:g}=Te("inputValue",me().test("required",a=>"valid.required",a=>!$.hasInput(u.value)||!!a).test("target-value",a=>"invalid_value",a=>$.isValid(u.value,a??""))),t=(j=v.data)==null?void 0:j.data;s.action=(t==null?void 0:t.action)??"block",s.direction=(t==null?void 0:t.direction)??"inbound",s.protocol=(t==null?void 0:t.protocol)??"all",u.value=((K=(G=v.data)==null?void 0:G.target)==null?void 0:K.type)??b.DNS,p.value=((X=(P=v.data)==null?void 0:P.target)==null?void 0:X.value)??"",s.apply_to=((z=(Y=v.data)==null?void 0:Y.applyTo)==null?void 0:z.toValue())??"all",s.notes=(t==null?void 0:t.notes)??"",s.is_enabled=(t==null?void 0:t.is_enabled)??!0,t||m(),_e(u,(a,i)=>{(a===b.INTERFACE||i===b.INTERFACE)&&(p.value="")});const _=h(()=>{const a=new $;a.type=u.value,a.value=p.value??"",s.target=a.toValue(),v.data?E({id:v.data.id,input:{group:"rule",value:JSON.stringify(s)}}):U({input:{group:"rule",value:JSON.stringify(s)}})});return S(()=>{W()}),l(()=>{W()}),(a,i)=>{const se=ye,ie=ve,de=Ve;return c(),fe(de,{title:d(t)?a.$t("edit"):a.$t("create")},{body:F(()=>{var V,H;return[e("div",Ae,[e("label",Ne,n(a.$t("actions")),1),e("div",De,[e("div",Ie,[f(e("input",{class:"form-check-input",type:"radio",name:"action",id:"action-allow",value:"allow","onUpdate:modelValue":i[0]||(i[0]=o=>s.action=o)},null,512),[[T,s.action]]),e("label",Ue,n(a.$t("allow")),1)]),e("div",Me,[f(e("input",{class:"form-check-input",type:"radio",name:"action",id:"action-block",value:"block","onUpdate:modelValue":i[1]||(i[1]=o=>s.action=o)},null,512),[[T,s.action]]),e("label",Se,n(a.$t("block")),1)])])]),e("div",Ee,[e("label",qe,n(a.$t("direction")),1),e("div",Re,[e("div",Oe,[f(e("input",{class:"form-check-input",type:"radio",name:"direction",id:"direction-inbound",value:"inbound","onUpdate:modelValue":i[2]||(i[2]=o=>s.direction=o)},null,512),[[T,s.direction]]),e("label",Je,n(a.$t("inbound")),1)]),e("div",Le,[f(e("input",{class:"form-check-input",type:"radio",name:"direction",id:"direction-outbound",value:"outbound","onUpdate:modelValue":i[3]||(i[3]=o=>s.direction=o)},null,512),[[T,s.direction]]),e("label",Be,n(a.$t("outbound")),1)])])]),e("div",Qe,[e("label",je,n(a.$t("match")),1),e("div",Ge,[f(e("select",{class:"form-select","onUpdate:modelValue":i[4]||(i[4]=o=>u.value=o)},[(c(!0),r(y,null,w(d(D),o=>(c(),r("option",{value:o},n(a.$t(`target_type.${o}`)),9,Ke))),256))],512),[[O,u.value]]),d($).hasInput(u.value)?(c(),r("div",Pe,[f(e("input",{type:"text",class:"form-control","onUpdate:modelValue":i[5]||(i[5]=o=>Z(p)?p.value=o:null),placeholder:a.$t("for_example")+" "+d($).hint(u.value)},null,8,Xe),[[x,d(p)]]),N(ie,{class:"input-group-text"},{content:F(()=>[e("pre",ze,n(a.$t(`examples_${u.value}`)),1)]),default:F(()=>[e("span",Ye,[N(se,{class:"bi"})])]),_:1})])):J("",!0),u.value===d(b).INTERFACE?f((c(),r("select",{key:1,class:"form-select mt-2","onUpdate:modelValue":i[6]||(i[6]=o=>Z(p)?p.value=o:null)},[e("option",He,n(a.$t("all_local_networks")),1),(c(!0),r(y,null,w((V=k.networks)==null?void 0:V.filter(o=>o.type!=="wan"),o=>(c(),r("option",{value:o.ifName},n(o.name),9,We))),256))],512)),[[O,d(p)]]):J("",!0),d(g)?(c(),r("div",Ze,n(d(g)?a.$t(d(g)):""),1)):J("",!0)])]),e("div",xe,[e("label",et,n(d(I)("apply_to")),1),e("div",tt,[f(e("select",{class:"form-select","onUpdate:modelValue":i[7]||(i[7]=o=>s.apply_to=o)},[e("option",ot,n(a.$t("all_devices")),1),(c(!0),r(y,null,w((H=k.networks)==null?void 0:H.filter(o=>o.type!=="wan"),o=>(c(),r("option",{key:o.ifName,value:"iface:"+o.ifName},n(o.name),9,nt))),128)),(c(!0),r(y,null,w(k.devices,o=>(c(),r("option",{value:"mac:"+o.mac},n(o.name),9,at))),256))],512),[[O,s.apply_to]])])]),e("div",lt,[e("label",st,n(a.$t("notes")),1),e("div",it,[f(e("textarea",{class:"form-control","onUpdate:modelValue":i[8]||(i[8]=o=>s.notes=o),rows:"3"},null,512),[[x,s.notes]])])])]}),action:F(()=>[e("button",{type:"button",disabled:d(M)||d(q),class:"btn",onClick:i[9]||(i[9]=(...V)=>d(_)&&d(_)(...V))},n(a.$t("save")),9,dt)]),_:1},8,["title"])}}}),ct={class:"page-container container"},rt={class:"main"},ut={class:"v-toolbar"},pt={class:"table"},mt=e("th",null,"ID",-1),_t={class:"actions two"},ft={class:"form-check"},vt=["disabled","onChange","onUpdate:modelValue"],gt=["title"],ht=["title"],bt={class:"actions two"},$t=["onClick"],kt=["onClick"],It=ae({__name:"RulesView",setup(k){const v=A([]),h=A([]),s=A([]),{t:u}=le();ge({handle:(l,p)=>{p?he(u(p),"error"):(v.value=l.configs.filter(m=>m.group==="rule").map(m=>{const g=JSON.parse(m.value),t=new we;t.parse(g.apply_to);const _=new $;return _.parse(g.target),{id:m.id,createdAt:m.createdAt,updatedAt:m.updatedAt,data:g,applyTo:t,target:_}}),h.value=[...l.devices],s.value=[...l.networks])},document:L`
    query {
      configs {
        ...ConfigFragment
      }
      devices {
        ...DeviceFragment
      }
      networks {
        ...NetworkFragment
      }
    }
    ${be}
    ${C}
    ${$e}
  `});const D=L`
  mutation DeleteConfig($id: ID!) {
    deleteConfig(id: $id)
  }
`;function I(l){B(Ce,{id:l.id,name:l.id,gql:D,appApi:!1,typeName:"Config"})}function U(l){B(ne,{data:l,devices:h,networks:s})}function M(){B(ne,{data:null,devices:h,networks:s})}const{mutate:S,loading:E}=Q({document:L`
    mutation updateConfig($id: ID!, $input: ConfigInput!) {
      updateConfig(id: $id, input: $input) {
        ...ConfigFragment
      }
    }
    ${C}
  `});function q(l){S({id:l.id,input:{group:"rule",value:JSON.stringify(l.data)}})}return(l,p)=>{const m=re,g=ce;return c(),r("div",ct,[e("div",rt,[e("div",ut,[N(m,{current:()=>l.$t("page_title.rules")},null,8,["current"]),e("button",{type:"button",class:"btn right-actions",onClick:M},n(l.$t("create")),1)]),e("table",pt,[e("thead",null,[e("tr",null,[mt,e("th",null,n(l.$t("apply_to")),1),e("th",null,n(l.$t("description")),1),e("th",null,n(l.$t("notes")),1),e("th",null,n(l.$t("enabled")),1),e("th",null,n(l.$t("created_at")),1),e("th",null,n(l.$t("updated_at")),1),e("th",_t,n(l.$t("actions")),1)])]),e("tbody",null,[(c(!0),r(y,null,w(v.value,t=>(c(),r("tr",{key:t.id},[e("td",null,[N(g,{id:t.id,raw:t.data},null,8,["id","raw"])]),e("td",null,n(t.applyTo.getText(l.$t,h.value,s.value)),1),e("td",null,n(l.$t(`rule_${t.data.direction}`,{action:l.$t(t.data.action),target:t.target.getText(l.$t,s.value)})),1),e("td",null,n(t.data.notes),1),e("td",null,[e("div",ft,[f(e("input",{class:"form-check-input",disabled:d(E),onChange:_=>q(t),"onUpdate:modelValue":_=>t.data.is_enabled=_,type:"checkbox"},null,40,vt),[[ke,t.data.is_enabled]])])]),e("td",{class:"nowrap",title:d(ee)(t.createdAt)},n(d(te)(t.createdAt)),9,gt),e("td",{class:"nowrap",title:d(ee)(t.updatedAt)},n(d(te)(t.updatedAt)),9,ht),e("td",bt,[e("a",{href:"#",class:"v-link",onClick:oe(_=>U(t),["prevent"])},n(l.$t("edit")),9,$t),e("a",{href:"#",class:"v-link",onClick:oe(_=>I(t),["prevent"])},n(l.$t("delete")),9,kt)])]))),128))])])])])}}});export{It as default};
